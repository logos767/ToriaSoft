{% extends "base.html" %}

{% block content %}
<div class="container mx-auto p-4 max-w-4xl">
    <h1 class="text-3xl font-bold text-gray-800 mb-6"><i class="fas fa-user-circle mr-2"></i>Mi Perfil</h1>

    <div class="bg-white p-8 rounded-lg shadow-md">
        <form method="POST" action="{{ url_for('main.user_profile') }}" enctype="multipart/form-data">
            {{ form.hidden_tag() }}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Columna de Foto de Perfil -->
                <div class="md:col-span-1 flex flex-col items-center">
                    <img id="profile-pic-preview" src="{{ image_file }}" alt="Foto de Perfil" class="w-40 h-40 rounded-full object-cover mb-4 border-4 border-gray-200">
                    <div class="w-full">
                        {{ form.picture.label(class="block text-gray-700 text-sm font-bold mb-2 text-center") }}
                        {{ form.picture(class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none", onchange="previewImage(event)") }}
                        {% if form.picture.errors %}
                            {% for error in form.picture.errors %}
                                <span class="text-red-500 text-xs">{{ error }}</span>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>

                <!-- Columna de Información Personal -->
                <div class="md:col-span-2">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Información Personal</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="mb-4">
                            {{ form.first_name.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                            {{ form.first_name(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        </div>
                        <div class="mb-4">
                            {{ form.last_name.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                            {{ form.last_name(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Documento de Identidad</label>
                        <div class="flex">
                            {{ form.doc_type(class="shadow-sm border rounded-l-md py-2 px-3 bg-gray-50 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                            {{ form.doc_number(class="shadow-sm appearance-none border rounded-r-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        </div>
                    </div>
                    <div class="mb-4">
                        {{ form.email.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                        {{ form.email(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>
                    <div class="mb-4">
                        {{ form.address.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                        {{ form.address(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Cargo</label>
                        <p class="bg-gray-100 rounded w-full py-2 px-3 text-gray-700">{{ current_user.role }}</p>
                    </div>
                </div>
            </div>

            <!-- Información Bancaria y Redes Sociales -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8 border-t pt-6">
                <div>
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Información Bancaria</h2>
                    <div class="mb-4">
                        {{ form.bank_name.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                        {{ form.bank_name(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>
                    <div class="mb-4">
                        {{ form.bank_account_number.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                        {{ form.bank_account_number(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>
                </div>
                <div>
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Redes Sociales</h2>
                    <div class="space-y-4">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fab fa-facebook text-blue-600"></i>
                            </div>
                            {{ form.social_facebook(class="shadow appearance-none border rounded w-full py-2 pl-10 pr-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500", placeholder="usuario.facebook") }}
                        </div>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fab fa-instagram text-pink-500"></i>
                            </div>
                            {{ form.social_instagram(class="shadow appearance-none border rounded w-full py-2 pl-10 pr-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500", placeholder="@usuario.instagram") }}
                        </div>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fab fa-twitter text-blue-400"></i>
                            </div>
                            {{ form.social_x(class="shadow appearance-none border rounded w-full py-2 pl-10 pr-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500", placeholder="@usuarioX") }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botón de Guardar -->
            <div class="flex items-center justify-end mt-8 border-t pt-6">
                {{ form.submit(class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline") }}
            </div>
        </form>
    </div>
</div>

<script>
function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function(){
        const output = document.getElementById('profile-pic-preview');
        output.src = reader.result;
    };
    reader.readAsDataURL(event.target.files[0]);
}
</script>
{% endblock %}