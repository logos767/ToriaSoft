{% extends "base.html" %}

{% block content %}
<div class="container mx-auto p-4 max-w-7xl">
    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
        <h1 class="text-3xl font-bold text-gray-800"><i class="fas fa-boxes mr-2"></i>Existencias por Almac√©n</h1>
        <div class="flex items-center space-x-2">
            <a href="{{ url_for('main.inventory_stock_report_pdf') }}" target="_blank" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 transition-colors">
                <i class="fas fa-file-pdf mr-2"></i>Imprimir Lista
            </a>
            {% if is_administrador() %}
            <a href="{{ url_for('main.inventory_adjustment') }}" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                <i class="fas fa-clipboard-check mr-2"></i>Ajuste Digital
            </a>
            {% endif %}
        </div>
    </div>
    <div class="bg-white p-1 rounded-lg shadow-md overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white text-sm">
                <thead class="bg-gray-100 sticky top-0">
                    <tr>
                        <th class="py-2 px-3 text-left font-semibold text-gray-600">Producto</th>
                        {% for wh in warehouses %}
                        <th class="py-2 px-3 text-center font-semibold text-gray-600">{{ wh.name }}</th>
                        {% endfor %}
                        <th class="py-2 px-3 text-center font-semibold text-gray-600 bg-gray-200">Total</th>
                    </tr>
                </thead>
                <tbody class="text-gray-700 divide-y divide-gray-200">
                    {% for product_data in products_data %}
                    {% set product = product_data %}
                    {% set stock_map = {} %}
                    {% for stock_level in product.stock_levels %}
                        {% set _ = stock_map.update({stock_level.warehouse_id: stock_level.quantity}) %}
                    {% endfor %}
                    <tr>
                        <td class="py-2 px-3 font-medium">{{ product.name }}</td>
                        {% for wh in warehouses %}
                        <td class="py-2 px-3 text-center font-mono">{{ stock_map.get(wh.id, 0) }}</td>
                        {% endfor %}
                        <td class="py-2 px-3 text-center font-bold font-mono bg-gray-50">{{ product.stock }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="{{ warehouses|length + 2 }}" class="py-4 px-3 text-center text-gray-500">No hay productos en el inventario.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}